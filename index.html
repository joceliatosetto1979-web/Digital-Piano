<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Virtual Piano+ Pro Edition</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body, html { width: 100vw; height: 100vh; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; }
        
        /* Telas */
        .tela { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; background: #111; z-index: 10; padding: 20px; }
        .ativa { display: flex; }
        
        /* Painel */
        #painel { height: 25%; width: 100%; background: #1a1a1a; display: flex; flex-direction: column; justify-content: space-around; padding: 10px; border-bottom: 2px solid #333; }
        .linha { display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 10px; }
        input[type=range] { flex: 1; accent-color: #FFD700; }
        
        /* Teclado */
        #teclado { height: 75%; width: 100%; display: flex; overflow-x: auto; touch-action: none; background: #000; }
        .tecla { flex-shrink: 0; position: relative; border-radius: 0 0 10px 10px; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 20px; user-select: none; border: 1px solid #999; }
        .branca { width: 70px; height: 100%; background: white; color: #333; }
        .preta { width: 45px; height: 60%; background: #222; color: white; margin-left: -22.5px; margin-right: -22.5px; z-index: 2; border: 1px solid #000; }
        .alvo-amarelo { background: #FFD700 !important; box-shadow: 0 0 20px #FFD700; z-index: 3; }
        
        /* Bot√µes */
        .btn { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .btn-menu { width: 220px; padding: 18px; margin: 8px; border-radius: 50px; font-size: 1.1rem; background: #4CAF50; }
        
        /* Cards de Notas */
        .card-nota { background: #222; border-left: 5px solid #FFD700; padding: 15px; margin-bottom: 15px; width: 100%; border-radius: 5px; }
        .card-nota h3 { color: #FFD700; margin-bottom: 10px; font-size: 1.1rem; }
        .card-nota p { color: #ccc; font-family: monospace; font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px; }
        .btns-print-row { display: flex; gap: 10px; }
        .btn-print-azul { background: #2196F3; flex: 1; font-size: 0.7rem; padding: 8px; }
        .btn-print-vermelho { background: #f44336; flex: 1; font-size: 0.7rem; padding: 8px; }

        /* CONFIGURA√á√ÉO DE IMPRESS√ÉO */
        @media print {
            body { background: white !important; }
            .no-print, .btn, .btn-menu, #m-p, #t-j, #t-m, #teclado, #painel, .btns-print-row { display: none !important; }
            .tela { display: block !important; position: static !important; background: white !important; padding: 0 !important; }
            .card-nota { display: none !important; }
            .card-nota.imprimir-agora { display: block !important; background: white !important; border: none !important; text-align: center !important; margin-top: 50px; }
            .card-nota.imprimir-agora h3 { color: black !important; font-size: 26pt !important; text-transform: uppercase; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 30px !important; }
            .card-nota.imprimir-agora.tipo-azul p { font-size: 18pt !important; line-height: 2.2 !important; word-spacing: 12px !important; color: black !important; }
            .card-nota.imprimir-agora.tipo-vermelho p { font-size: 22pt !important; font-weight: bold !important; line-height: 2.5 !important; word-spacing: 18px !important; text-transform: uppercase; color: black !important; }
        }
    </style>
</head>
<body>

    <div id="m-p" class="tela ativa">
        <h1 style="color:#FFD700; margin-bottom:30px;">VIRTUAL PIANO+</h1>
        <button class="btn-menu" onclick="irJogo()">PLAY</button>
        <button class="btn-menu" style="background:#2196F3;" onclick="irMus()">M√öSICAS</button>
        <button class="btn-menu" style="background:#FFD700; color:#000;" onclick="irNotas()">VER NOTAS</button>
    </div>

    <div id="t-n" class="tela" style="justify-content: flex-start; overflow-y: auto;">
        <div class="no-print" style="width: 100%; margin-bottom: 20px;">
            <button class="btn" style="background:#555; width: 100%;" onclick="irMenu()">‚¨Ö VOLTAR AO MENU</button>
        </div>
        <div id="lista-notas-texto" style="width: 100%;"></div>
    </div>

    <div id="t-m" class="tela" style="justify-content:flex-start; overflow-y:auto;">
        <button class="btn" style="background:#555; margin-bottom:20px; width: 100%;" onclick="irMenu()">‚¨Ö VOLTAR</button>
        <div id="lista-m" style="width:100%;"></div>
    </div>

    <div id="t-j" class="tela" style="justify-content:flex-start; padding: 0;">
        <div id="painel">
            <div class="linha">
                <button class="btn" style="background:#f44336;" onclick="irMenu()">SAIR</button>
                <div style="text-align:center;"><b id="txt-m" style="color:white;">Livre</b></div>
                <button id="btn-rec" class="btn" style="background:#555;" onclick="toggleRec()">‚è∫ GRAVAR</button>
            </div>
            <div class="linha">
                <span style="color:white; font-size: 0.8rem;">PITCH:</span>
                <input type="range" id="pitch" min="0.1" max="4.0" step="0.1" value="1.3">
                <b id="val-pitch" style="color:#FFD700;">1.3</b>
            </div>
            <div class="linha">
                <span style="color:white; font-size: 0.8rem;">VOL:</span>
                <input type="range" id="vol" min="0" max="1" step="0.1" value="0.5" oninput="mG.gain.value = this.value">
                <b id="val-vol" style="color:#FFD700;">50%</b>
            </div>
        </div>
        <div id="teclado"></div>
    </div>

<script>
    let ctx, mG, rec, chunks = [], notas = new Map();
    let mus = null, passo = 0, segurando = false;
    const nms = ['D√≥','D√≥#','R√©','R√©#','Mi','F√°','F√°#','Sol','Sol#','L√°','L√°#','Si','D√≥2','D√≥#2','R√©2','R√©#2','Mi2','F√°2','F√°#2','Sol2','Sol#2','L√°2','L√°#2','Si2','D√≥3'];

    const banco = [
        { id: 1, nome: "Parab√©ns pra Voc√™ (Completa)", pitchBase: 1.2, seq: [
            // Parab√©ns pra voc√™
            [0,300],[0,150],[2,450],[0,450],[5,450],[4,900],[-1,300],
            // Nesta data querida
            [0,300],[0,150],[2,450],[0,450],[7,450],[5,900],[-1,300],
            // Muitas felicidades
            [0,300],[0,150],[12,450],[9,450],[5,450],[4,450],[2,900],[-1,300],
            // Muitos anos de vida
            [10,300],[10,150],[9,450],[5,450],[7,450],[5,900]
        ]},
        { id: 2, nome: "Bate o Sino (Completa)", pitchBase: 1.3, seq: [
            [4,300],[4,300],[4,600],[-1,100],[4,300],[4,300],[4,600],[-1,100],
            [4,300],[7,300],[0,300],[2,300],[4,800],[-1,200],
            [5,300],[5,300],[5,300],[5,300],[5,300],[4,300],[4,300],
            [4,300],[2,300],[2,300],[4,300],[2,600],[7,600],[-1,200],
            [4,300],[4,300],[4,600],[-1,100],[4,300],[4,300],[4,600],[-1,100],
            [4,300],[7,300],[0,300],[2,300],[4,800],[-1,200],
            [5,300],[5,300],[5,300],[5,300],[5,300],[4,400],[4,400],
            [7,300],[7,300],[5,300],[2,300],[0,800]
        ]},
        { id: 3, nome: "Baby Shark", pitchBase: 1.6, seq: [[2,400],[-1,50],[4,400],[-1,50],[7,150],[-1,50],[7,150],[-1,50],[7,150],[-1,100],[7,150],[-1,50],[7,150],[-1,50],[7,150],[-1,100],[7,150],[-1,50],[7,150],[-1,50],[7,150],[-1,100],[7,150],[-1,50],[7,150],[-1,50],[6,600]] },
        { id: 4, nome: "Harry Potter Theme", pitchBase: 1.3, seq: [[11,250],[-1,50],[16,600],[-1,50],[19,200],[-1,50],[18,200],[-1,50],[16,600],[-1,50],[23,400],[-1,50],[21,800],[-1,150],[18,800],[-1,50],[16,600],[-1,50],[19,200],[-1,50],[18,200],[-1,50],[15,600],[-1,50],[17,400],[-1,50],[11,1000]] }
    ];

    function init() { 
        if(!ctx) { 
            ctx = new (window.AudioContext || window.webkitAudioContext)(); 
            mG = ctx.createGain(); 
            mG.gain.value = 0.5; 
            mG.connect(ctx.destination); 
            let dest = ctx.createMediaStreamDestination(); 
            mG.connect(dest); 
            rec = new MediaRecorder(dest.stream); 
            rec.ondataavailable = e => chunks.push(e.data); 
            rec.onstop = () => { 
                let b = new Blob(chunks, {type:'audio/webm'}); 
                let a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'piano.webm'; a.click(); 
            }; 
        } 
    }
    
    function irMenu() { document.querySelectorAll('.tela').forEach(t=>t.classList.remove('ativa')); document.getElementById('m-p').classList.add('ativa'); }
    function irJogo() { document.querySelectorAll('.tela').forEach(t=>t.classList.remove('ativa')); document.getElementById('t-j').classList.add('ativa'); init(); mus = null; document.getElementById('txt-m').innerText = "Livre"; }
    
    function irMus() { 
        document.querySelectorAll('.tela').forEach(t=>t.classList.remove('ativa')); 
        document.getElementById('t-m').classList.add('ativa'); 
        const l = document.getElementById('lista-m'); l.innerHTML = ''; 
        banco.forEach(m => { 
            l.innerHTML += `<div style="background:#222; margin-bottom:10px; padding:15px; border-radius:12px; display:flex; justify-content:space-between; color:white;"><span>${m.nome}</span> <button class="btn" style="background:#FFD700; color:#000;" onclick="playM(${m.id})">PLAY</button></div>`; 
        }); 
    }
    
    function irNotas() {
        document.querySelectorAll('.tela').forEach(t=>t.classList.remove('ativa')); document.getElementById('t-n').classList.add('ativa');
        const c = document.getElementById('lista-notas-texto'); c.innerHTML = '';
        banco.forEach((m, idx) => {
            let s = m.seq.filter(n => n[0] !== -1).map(n => nms[n[0]]).join(" - ");
            c.innerHTML += `<div class="card-nota" id="card-${idx}"><h3>${m.nome}</h3><p>${s}</p><div class="btns-print-row"><button class="btn btn-print-azul" onclick="imprimir('card-${idx}', 'azul')">üéº PARTITURA</button><button class="btn btn-print-vermelho" onclick="imprimir('card-${idx}', 'vermelho')">üéπ D√ì-R√â-M√ç</button></div></div>`;
        });
    }

    function imprimir(id, tipo) { document.querySelectorAll('.card-nota').forEach(c => c.classList.remove('imprimir-agora', 'tipo-azul', 'tipo-vermelho')); document.getElementById(id).classList.add('imprimir-agora', 'tipo-' + tipo); window.print(); }
    
    function playM(id) { 
        mus = banco.find(m => m.id === id); passo = 0; 
        document.getElementById('pitch').value = mus.pitchBase; 
        document.getElementById('val-pitch').innerText = mus.pitchBase.toFixed(1); 
        document.querySelectorAll('.tela').forEach(t=>t.classList.remove('ativa')); 
        document.getElementById('t-j').classList.add('ativa'); 
        init(); document.getElementById('txt-m').innerText = mus.nome; 
        prox(); 
    }

    function prox() { 
        document.querySelectorAll('.tecla').forEach(t => t.classList.remove('alvo-amarelo')); 
        if(mus && passo >= mus.seq.length) { alert("Fim da M√∫sica!"); irMenu(); return; } 
        if(mus) { 
            let n = mus.seq[passo][0]; 
            if(n === -1) { setTimeout(() => { passo++; prox(); }, mus.seq[passo][1]); } 
            else { document.getElementById('k'+n).classList.add('alvo-amarelo'); } 
        } 
    }

    function handleStart(id, f) { init(); som(f * document.getElementById('pitch').value, id); if(mus && id === 'k'+mus.seq[passo][0]) segurando = true; }
    function handleEnd(id) { off(id); if(mus && segurando && id === 'k'+mus.seq[passo][0]) { passo++; prox(); } segurando = false; }
    
    function toggleRec() { init(); const b = document.getElementById('btn-rec'); if(rec.state === 'inactive') { chunks = []; rec.start(); b.innerText = "‚èπ PARAR"; } else { rec.stop(); b.innerText = "‚è∫ GRAVAR"; } }

    const tcl = document.getElementById('teclado');
    for(let i=0; i<25; i++) {
        let div = document.createElement('div'), f = 130.81 * Math.pow(2, i/12), id = 'k'+i;
        div.className = 'tecla ' + (nms[i%12].includes('#') ? 'preta' : 'branca'); div.id = id;
        div.innerHTML = `<small style="pointer-events:none;">${nms[i]}</small>`;
        div.onpointerdown = (e) => { div.setPointerCapture(e.pointerId); handleStart(id, f); };
        div.onpointerup = (e) => handleEnd(id); tcl.appendChild(div);
    }
    
    function som(f, id) { 
        if(!ctx || notas.has(id)) return; 
        let o = ctx.createOscillator(), g = ctx.createGain(); 
        o.type = 'triangle'; 
        o.frequency.value = f; 
        g.gain.setValueAtTime(0, ctx.currentTime); 
        g.gain.linearRampToValueAtTime(0.4, ctx.currentTime + 0.02); 
        o.connect(g); g.connect(mG); o.start(); 
        notas.set(id, {o, g}); 
    }

    function off(id) { 
        let n = notas.get(id); 
        if(n) { 
            n.g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.1); 
            n.o.stop(ctx.currentTime + 0.12); 
            notas.delete(id); 
        } 
    }

    document.getElementById('vol').addEventListener('input', (e) => {
        document.getElementById('val-vol').innerText = Math.round(e.target.value * 100) + "%";
    });
</script>
</body>
    </html>
            
